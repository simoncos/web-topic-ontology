document.domain="qq.com";var v201404161912;
(function(a,l,n){function q(a){return a}function f(a){return decodeURIComponent(a.replace(m," "))}var m=/\+/g,b=a.cookie=function(c,e,d){if(e!==n){d=a.extend({},b.defaults,d);null===e&&(d.expires=-1);if("number"===typeof d.expires){var g=d.expires,h=d.expires=new Date;h.setDate(h.getDate()+g)}e=b.json?JSON.stringify(e):String(e);return l.cookie=[encodeURIComponent(c),"=",b.raw?e:encodeURIComponent(e),d.expires?"; expires="+d.expires.toUTCString():"",d.path?"; path="+d.path:"",d.domain?"; domain="+
d.domain:"",d.secure?"; secure":""].join("")}e=b.raw?q:f;d=l.cookie.split("; ");for(g=0;h=d[g]&&d[g].split("=");g++)if(e(h.shift())===c)return c=e(h.join("=")),b.json?JSON.parse(c):c;return null};b.defaults={domain:"qq.com",path:"/",expires:7};a.removeCookie=function(b,e){return null!==a.cookie(b)?(a.cookie(b,null,e),!0):!1}})(jQuery,document);
(function(a,l,n,q){var f,m,b="onfocusin"in l&&"hasFocus"in l?"focusin focusout":"focus blur",c=["","moz","ms","o","webkit"],e=n.support,d=n.event;for(;(m=f=c.pop())!=q;)if(m=(f?f+"H":"h")+"idden",e.pageVisibility="boolean"==typeof l[m]){b=f+"visibilitychange";break}n(/blur$/.test(b)?a:l).bind(b,function(a){var b=a.type;a=a.originalEvent;var c=a.toElement;(!/^focus./.test(b)||c==q&&a.fromElement==q&&a.relatedTarget==q)&&d.trigger((m&&l[m]||/^(?:blur|focusout)$/.test(b)?"hide":"show")+".visibility")})})(this,
document,jQuery);"undefined"!=typeof $&&$.noConflict&&"object"!=typeof jQuery&&$.noConflict();
jQuery(document).ready(function(){(function(a){var l=a(document);a(parent.document);a(window);var n=a("body"),q=null,f=f||parent.cmt_id,m="",m="www"==top.location.host.split(".")[0]?top.location.host.split(".")[1]:top.location.host.split(".")[0];a.widget("qq.comment",{options:{$content:a("#content"),$loginTrigger:a("#onekey"),$logoutTrigger:a("#loginOut"),$popReply:a("#public_reply"),$topReply:a("#top_reply"),$top_textarea:a("#top_textarea"),$allComments:a("#allComments"),$showNum:a("#showNum"),$commentTotleNum:a("#commentTotleNum"),
$loadMore:a("#loadMore"),fetchUrl:"http://coral.qq.com/",wfetchUrl:"http://w.coral.qq.com/",pfetchUrl:"http://pull.coral.qq.com/",topCallback:"parent.topCallback",popCallback:"parent.popCallback",reportCallback:"parent.reportCallback",deleteCallback:"parent.deleteCallback",$allComments:a("#tab1_allComments"),$myComments:a("#tab2_myComments"),$myTips:a("#tab3_tips"),$myCons:a("#tab4_mycon"),$loginFlag:a("#loginFlag"),$loginBtn:a("#top_post_btn"),$iframeHeight:"0",$replylistId:"",$myCowComment:a("#myCowComment"),
$myAllComment:a("#myAllComment"),$tabFlag:!0,$realtimeComments:0,$insertFlag:"comment",$nowDate:new Date,$urlapi:{userId:0,first:"",last:"",msgid:"",pageflag:0},$urlapi_mycomment:{userId:0,first:"",last:"",msgid:"",pageflag:0},loginuin:0,pubSucEvent:"commentpubsuccess",topContentTips:"",homePageSize:10,centerPageSize:10,loadPageSize:20,newsNum:0,hotNums:10,columSource:1,columsubSource:0,columCode:1,columApi:1,columLink:1,columHot:1,commentNumbers:"",popupInfo:"popClick",popupLink:"np-postlink",reportBtn:1,
centerFlag:0,changeFlag:0,reportId:"",hotPageSize:10,order:"",upId:"",siteName:"",lastId:""},_create:function(){var b=this;this.init();this.changeTab();this.bindSubmitEvent();this.bindReportEvent();this.bindDeleteEvent();this.bindFooterEvent(this.options.$content);this.bindOtherEvents();this.loadCommentNum();this.hotList();this.makeCommentList();this.tabsComment();this.clickLoadMore();this.sendStat(m);this.initPostFrame();this.loadNum();this.element.bind(this.options.pubSucEvent,function(c,e){b.insertTempComment(e.data.commentid,
e.data.content,e.data.parent,e.data.time,e.data.checktype);b.options.$urlapi_mycomment.msgid=b.options.$urlapi_mycomment.first;b.options.columApi&&a("#mycon").hasClass("np-active")&&a("#myCowComment").hasClass("np-active")&&(b.options.$urlapi_mycomment.pageflag=0,b.loadMyComment());b.updateTime()})},init:function(){var b=this.options;a(parent.document).find("#commentIframe").css({"-webkit-transition":"height 0.6s ease",transition:"height 0.6s ease"});a("#mainBody").css("width","100%");b.commentNumbers=
a(parent.document).find(".commentNumbers")?a(parent.document).find(".commentNumbers"):"";a("#allComments .post-list").length||a("#allComments").append("<ul class='post-list'></ul>");a("a").each(function(){a(this).attr("hideFocus","true")});if(parent.registerCoralEvent){parent.registerCoralEvent.source&&(b.columSource=parent.registerCoralEvent.source);parent.registerCoralEvent.subsource&&(b.columsubSource=parent.registerCoralEvent.subsource);if(0==parent.registerCoralEvent.code||1==parent.registerCoralEvent.code)b.columCode=
parent.registerCoralEvent.code;parent.registerCoralEvent.ownStyle&&a("head").append('<link href="'+parent.registerCoralEvent.ownStyle+'" rel="stylesheet" type="text/css" media="screen"/>');parent.registerCoralEvent.listHiden&&(a("#content").hide(),b.columApi=0,a(parent.document).find("#commentIframe").height(152));parent.registerCoralEvent.commentNums&&(b.homePageSize=parent.registerCoralEvent.commentNums);0==parent.registerCoralEvent.commentLink&&(b.columLink=parent.registerCoralEvent.commentLink);
2==parent.registerCoralEvent.commentLink&&(b.columLink=parent.registerCoralEvent.commentLink);0==parent.registerCoralEvent.commentHot&&(b.columHot=parent.registerCoralEvent.commentHot);parent.registerCoralEvent.commentHotNums&&(b.hotNums=parent.registerCoralEvent.commentHotNums);0==parent.registerCoralEvent.popupInfo&&(b.popupInfo="popupInfoOff");0==parent.registerCoralEvent.popupLink&&(b.popupLink="popupLinkOff");0==parent.registerCoralEvent.reportBtn&&(b.reportBtn=0);parent.registerCoralEvent.site&&
(b.siteName=parent.registerCoralEvent.site);if(top.location.host.match("coral.qq.com")){var c=top.location.host;null!=c.match(/(\w+)\.coral\.qq\.com/)&&(b.fetchUrl="http://"+c.match(/(\w+)\.coral\.qq\.com/)[1]+".coral.qq.com/")}else void 0!=parent.registerCoralEvent.site&&(b.fetchUrl="http://"+parent.registerCoralEvent.site+".coral.qq.com/")}},creatHtml:function(b,c,e){var d=b.userinfo.head?b.userinfo.head:"http://mat1.gtimg.com/www/coral2.0/images/g.gif",g=b.userinfo.nick;b.content.replace(/\n/g,
"<br />");b.userinfo.region.replace(/:/g," ");c=c?c:"";var h="",r="",s="",k="comment_",f="",l="popClick";"msg"==e&&(k="msg_",h="");"top"==e&&(k="top_",h="topIco np-label-digest",r="topAll");0==b.rep&&(s="topno");0<b.hotscale?f="":(b.userinfo.userid!=a.cookie("uid")&&this.options.reportBtn&&(f="<a href='javascript:void(0)' class='np-btn np-btn-report report' id='report_"+k+b.id+"'>\u4e3e\u62a5</a>"),h="");e=this.options.popupInfo;10001==b.replyuserid&&(l="");var p="",m="";b.rep&&(m="(<em>"+b.rep+"</em>)");
if(""!=b.content||0!=b.rep||0!=b.isdeleted){if(1==b.isdeleted)p+='<li class="np-post" id="'+k+b.id+'">',p=p+('<img class="np-avatar" src="'+d+'"alt="\u5934\u50cf"/>')+'<div class="np-post-body">',p+='<div class="np-post-header">',p+='<a href="javascript:void(0)" class="np-user">'+g+"</a>",p+=0==b.parent?" ":'<a href="javascript:void(0)" post_uid = "'+b.replyuserid+'" class="replywho np-icon-reply-weak np-user '+l+'" style="display:'+b.classNone+'">'+b.replyuser+"</a>",p+='<span class="np-time" data="'+
b.time+'" >'+this.formatTime(b.time)+"</span>",p+="</div>",p+='<div class="np-post-content padding-b"><p>\u6b64\u8d34\u5df2\u88ab\u7528\u6237\u5220\u9664</p></div>',p+="</div>",p+='<ul class="children"></ul>',p+="</li>";else if(2==b.checkstatus&&0!=b.rep)p+="<li class='postHide' id="+k+b.id+"><ul class='children'></ul></li>";else{var n="";void 0!=b.picture&&b.picture.length&&(n='<div><img class="np-con-img" src="'+b.picture[0].url+'/150" /></div>');p+='<li class="np-post '+c+" "+h+" "+r+" "+s+' " id="'+
k+b.id+'"><div class="np-tip-newpost"></div><img class="np-avatar '+e+'" post_uid ="'+b.userinfo.userid+'" src="'+d+'"alt="\u5934\u50cf"><div class="np-post-body"><div class="np-post-header">'+f+'<a href="javascript:void(0)" title="'+g+'" class="np-user '+e+' " post_uid = "'+b.userinfo.userid+'">'+g+"</a>"+(0==b.parent?'<a href="javascript:void(0)" class="replywho np-icon-reply-weak np-user" style="display:none">'+b.replyuser+"</a>":'<a href="javascript:void(0)" title="'+b.replyuser+'" post_uid = "'+
b.replyuserid+'" class="replywho np-icon-reply-weak np-user '+l+' " style="display:'+b.classNone+'">'+b.replyuser+"</a>")+'<span class="np-time" data="'+b.time+'" >'+this.formatTime(b.time)+'</span></div><div class="np-post-content"><p>'+b.content.replace(/\n/g,"<br />")+("topno"!=s&&"topAll"==r?this.creatPostLink(b):"")+"</p>"+n+'</div><div class="np-post-footer"><a href="javascript:void(0)" class="np-btn np-btn-upvote upvote" id=upvote_'+b.id+">(<em>"+b.up+'</em>)</a><a href="javascript:void(0)" class="np-btn np-btn-reply reply">\u56de\u590d'+
m+'</a><a href="javascript:void(0)" class="np-btn np-btn-newreply"></a></div></div><ul class="children"></ul></li>'}return p}},loadCommentNum:function(){var b=this,c=this.options;a.ajax({url:c.fetchUrl+"article/"+f+"/commentnum",dataType:"jsonp",jsonpCallback:"myHotcommentNum",beforeSend:function(){b._hotTimer0=(new Date).getTime()},success:function(a){0==a.errCode&&(c.commentNumbers.html(a.data.commentnum),c.$commentTotleNum.html("<span>"+a.data.commentnum+"\u6761\u8bc4\u8bba</span>"))}})},makeCommentList:function(){var b=
this,c=this.options;1==c.columLink?c.$commentTotleNum.attr("href",c.fetchUrl+f):(c.$commentTotleNum.attr("href","javascript:void(0)"),c.$commentTotleNum.removeAttr("target"),c.$commentTotleNum.css("cursor","default"),c.$commentTotleNum.css("text-decoration","none"));2==c.columLink&&(a("#globalNav h1").hide(),a("#globalNav").css("border-bottom","none"));a(parent.document.getElementById("cmtNum"))&&a(parent.document.getElementById("cmtNum")).attr({href:c.fetchUrl+f,target:"_blank"});c.columApi&&b.loadMore();
c.$loadMore.find("span").unbind().bind("click",function(){a("#loadMore>span").hide();a("#loadMore>em").addClass("np-load-more-loading").show();b.loadMore(c.lastId);0>=c.$loadMore.data("loadMoreNume")-c.homePageSize?(c.$loadMore.hide(),c.$loadMore.data("loadMoreNume",0)):c.$loadMore.data("loadMoreNume",c.$loadMore.data("loadMoreNume")-c.homePageSize);sendClientStat(m,1,f,"clk_allcomment_more")})},hotList:function(){var b=this,c=this.options,e=c.fetchUrl+"article/"+f+"/hotcomment?reqnum="+c.hotNums;
c.columHot&&a.ajax({url:e,dataType:"jsonp",jsonpCallback:"myHotcommentList",beforeSend:function(){b._hotTimer0=(new Date).getTime()},success:function(c){if(0==c.errCode){var e=(new Date).getTime();if(0!=c.data.commentid.length){var h=c.data.commentid.length;a.each(c.data.commentid,function(e,g){a("#allComments .post-list").prepend(b.creatHtml(c.data.commentid[h-e-1],0,"top"))});a.each(a("#allComments li.topAll"),function(b,c){b==h-1&&(a(this).addClass("noborder"),a(this).after('<li class="np-title-new">\u6700\u65b0\u8bc4\u8bba</li>'))});
a("#allComments .post-list").prepend('<li class="np-title-hot">\u70ed\u95e8\u8bc4\u8bba</li>');b.conHeight(5);setTimeout(function(){b.iframeHeight()},600)}}Qoss("zrpl",b._hotTimer0,{1:b._hotTimer0+1,2:e,3:e},100)}})},tabsComment:function(){var b=this,c=this.options;a("#mycon").unbind().click(function(){a(this).addClass("np-active");a("#mytips").removeClass("np-active");c.$myTips.hide();c.$myCons.show();0==a("#my-notification-list li").length&&(setTimeout(function(){b.loadMyComment()},500),a("#myuserInfo").hide());
sendClientStat(m,1,f,"clk_mycomment");b.iframeHeight()});a("#mytips").unbind().click(function(){a(this).addClass("np-active");a("#mycon").removeClass("np-active");c.$myTips.show();c.$myCons.hide();0==a("#my-message-list li").length&&b.loadMyMessage();sendClientStat(m,1,f,"clk_notice");b.iframeHeight()});""!=c.order&&(a("#order a").removeClass("np-active"),a("#order a[data-sort="+c.order+"]").addClass("np-active"));a("#order a").unbind().click(function(){"time"==a(this).attr("data-sort")?sendClientStat(m,
1,f,"clk_order_time"):sendClientStat(m,1,f,"clk_order_hot");a(this).hasClass("np-active")||(a("#order a").removeClass("np-active"),a(this).addClass("np-active"),a("#allComments .tipInfo").addClass("waitting").html("").show(),c.order="time"!=a(this).attr("data-sort")?a(this).attr("data-sort"):"",a("#allComments .post-list").html(""),a("#allComments .waitting").show(),c.$loadMore.hide(),"quality"!=c.order&&b.hotList(),setTimeout(function(){b.loadMore(0,1)},500))})},loadMore:function(b,c){function e(){0==
a("#allComments li").length&&a("#allComments").children(".tipInfo").removeClass("waitting").html("\u6682\u65e0\u8bc4\u8bba").show();a("#allComments .post-list").length||a("#allComments").append("<ul class='post-list'></ul>")}var d=this,g=this.options;b=b||0;var h=g.homePageSize;b&&(h=20);a.ajax({url:g.fetchUrl+"article/"+f+"/comment?commentid="+b+"&reqnum="+h+"&tag="+g.order,dataType:"jsonp",beforeSend:function(){d._latestTimer0=(new Date).getTime()},error:e,jsonpCallback:"mainComment",success:function(c){if(0==
c.errCode){g.lastId=c.data.last;var k=(new Date).getTime();c.data.retnum<c.data.reqnum||c.data.total<=g.homePageSize?(a("#loadMore>span").hide(),a("#loadMore>em").removeClass("np-load-more-loading")):(a("#loadMore>span").show(),a("#loadMore>em").hide());g.$showNum.data("maxID",c.data.maxid);r(c);d.iframeHeight();b||(c.data.reqnum<c.data.total&&0<a("#allComments li").length&&g.$loadMore.show(),g.$commentTotleNum.html("<span>"+c.data.total+"\u6761\u8bc4\u8bba</span>"),g.commentNumbers.html(c.data.total),
a(parent.document.getElementById("cmtNum"))&&a(parent.document.getElementById("cmtNum")).html(c.data.total),a(parent.document.getElementById("cmtNum2"))&&a(parent.document.getElementById("cmtNum2")).html(c.data.total))}else e();0==a("#allComments li").length&&g.$loadMore.hide();Qoss("zxpl",d._latestTimer0,{1:d._latestTimer0+1,2:k,3:k},100)}});var r=function(b){b.data.commentid.length||0!=a("#allComments li").length?a("#allComments").children(".tipInfo").hide():(""!=g.order&&1!=c&&a("#order span[data-sort=time]").trigger("click"),
"quality"==g.order?a("#allComments").children(".tipInfo").removeClass("waitting").html("\u6682\u65e0\u70ed\u8bc4").show():a("#allComments").children(".tipInfo").removeClass("waitting").html("\u6682\u65e0\u8bc4\u8bba").show(),g.$loadMore.hide());a("#allComments .post-list").length||a("#allComments").append("<ul class='post-list'></ul>");a.each(b.data.commentid,function(b,c){0==c.parent||0==a("#comment_"+c.parent).length?(0==a("#comment_"+c.parent).length&&0!=c.parent?c.classNone="none":c.classNone=
"",a("#allComments .post-list").append(d.creatHtml(c))):(a("#comment_"+c.parent).hasClass("postHide")?c.classNone="none":c.classNone="",a("#comment_"+c.parent+">ul.children").append(d.creatHtml(c)))});a("#allComments .post-list .postHide").find(".replywho:first").hide();setTimeout(function(){d.conHeight()},300);setTimeout(function(){d.iframeHeight()},500)}},blueLine:function(b){setTimeout(function(){a(b+">.np-tip-newpost").animate({opacity:"0"},1E4);setTimeout(function(){a(b+">.np-avatar").animate({left:"0px"},
400);a(b+">.np-post-body").animate({"padding-left":"10px"},400);a(b).removeClass("blueflag")},8E3)},5E3)},probeEvent:function(){var b=this,c=this.options,e=function(){c.$tabFlag?a.ajax({url:"http://sync.coral.qq.com/t/"+f,dataType:"jsonp",jsonpCallback:"propNum",success:function(a){a>c.$realtimeComments&&0!=a&&(c.$realtimeComments=a,b.loadNew());setTimeout(function(){e()},3E4)},error:function(){setTimeout(function(){e()},3E4)}}):setTimeout(function(){e()},3E4);b.updateTime()};e()},loadNum:function(){var b=
this.options,c=a.cookie("uid"),e="http://sync.coral.qq.com/u/"+c+"?platform="+b.siteName;if(/^\d+$/.test(c+"")){var d=function(){b.$tabFlag&&a.cookie("uin")?a.ajax({url:e,dataType:"jsonp",jsonpCallback:"userNum",success:function(b){0<b?a("#popMsg").html(b).show():a("#popMsg").html("").hide();setTimeout(function(){d()},3E4)},error:function(){setTimeout(function(){d()},3E4)}}):setTimeout(function(){d()},3E4)};d()}},loadNew:function(){var b=this,c=this.options;a.ajax({url:c.pfetchUrl+"article/"+f+"/sync?lastid="+
c.$showNum.data("maxID"),dataType:"jsonp",jsonpCallback:"newComment",timeout:3E4,success:function(e){b.options.$nowDate=1E3*e.info.time;if(0==e.errCode&&0!=e.data.length){e.data.maxid&&c.$showNum.data("maxID",e.data.maxid);a.each(e.data.commentid,function(d,e){if(0==a("#comment_"+e.id).length){if(2!=e.checkstatus){var h=c.$commentTotleNum.children("span").html();c.$commentTotleNum.children("span").html(parseInt(h)+1);c.commentNumbers.html(parseInt(h)+1)}0==e.parent?e.userinfo.userid!=a.cookie("uid")&&
(a("#hiddenCon").prepend(b.creatHtml(e)),h=a("#hiddenCon li"),a.each(h,function(b,c){a(c).addClass("blueflag")})):a.each(c.$allComments.find("li"),function(c,d){if(e.userinfo.userid!=a.cookie("uid")&&"comment_"+e.parent==d.id){void 0==a("#"+d.id).data("num")&&a("#"+d.id).data("num",0);if(a("#comment_"+e.parent).hasClass("undis")){var k=a("#comment_"+e.parent).parents("li:not(.undis):first");k.data("num",Number(k.data("num"))+1);var h=k.data("num")+"\u6761\u65b0\u56de\u590d",k=k.find(".post-footer:first>em.newcoment")}else a("#"+
d.id).data("num",Number(a("#"+d.id).data("num"))+1),h=a("#"+d.id).data("num")+"\u6761\u65b0\u56de\u590d",k=a(this).find(".post-footer:first>em.newcoment");k.html(h);k.show();a(d).find("ul:first").prepend(b.creatHtml(e,"undis"))}});a("#hiddenCon").html()&&e.parent&&(h=a("#hiddenCon li"),a.each(h,function(c,d){"comment_"+e.parent==d.id&&a(d).children(".children").append(b.creatHtml(e))}))}});if(e=a("#hiddenCon li").not(a(".hide")).length)a("#showNum span").html("<em>"+e+"</em> \u6761\u65b0\u8bc4\u8bba"),
a("#showNum").show().animate({height:"30px"},"slow",function(){b.iframeHeight()});a("#showNum").unbind().bind("click",function(){a("#allComments ul:first").prepend(a("#hiddenCon").html());a("#hiddenCon .blueflag").each(function(c,e){var h=a(this).attr("id");b.blueLine("#"+h)});a("#allComments li.temporary").remove();a("#hiddenCon").html("");a(this).hide();a("#allComments .tipInfo").hide();b.iframeHeight();c.newsNum=0;sendClientStat(m,1,f,"clk_newcomment_notice")});b.updateTime()}},error:function(a,
b,c){"timeout"==b&&setTimeout(function(){loadNewHtml()},5E3)}})},changeTab:function(){var b=this.options;a(document).bind({"show.visibility":function(){b.$tabFlag=!0},"hide.visibility":function(){b.$tabFlag=!1}})},bindFooterEvent:function(b){var c=this,e=this.options,d=a(".pop_reply"),g=a(".pop_reply a.submit"),h=a(".pop_reply textarea");b.delegate(".reply","click",function(e){e=e||window.event;var f=a(this).parents("li.np-post").attr("id");g.attr("id","pop_"+f);h.attr("id","pop_text_"+f);var k=a(this).closest(".np-post-body").next(".children");
k.find(".np-reply-box-footer a").removeClass("submitOn").addClass("submit").html("\u56de\u590d");k.find("textarea").val("");e.stopPropagation();k.has(".pop_reply").length&&"public_reply"==k.children().first().attr("id")?k.children(".pop_reply").is(":visible")?(k.children(".pop_reply").find(".commtSub").hide(),k.children(".pop_reply").slideUp("10",function(){c.iframeHeight()})):(k.children(".pop_reply").find(".commtSub").show(),k.children(".pop_reply").slideDown("100",function(){c.iframeHeight()}),
setTimeout(function(){k.children(".pop_reply").find("textarea").focus()},200)):(b.find(".pop_reply").slideUp("10",function(){a(this).remove();c.iframeHeight()}),k.prepend(d.clone()),k.children(".pop_reply").slideDown("100",function(){k.children(".pop_reply").find(".commtSub").show().animate({height:"48px"},"fast");c.iframeHeight()}),setTimeout(function(){k.children(".pop_reply").find("textarea").focus()},200));c.iframeHeight()});b.delegate(".pop_reply","click",function(a){a.stopPropagation()});b.delegate(".submit",
"click",function(){var b=c.getLoginStatus(),d=a(this).closest("[tid]").attr("tid");e.replylistId=a(this).attr("id").split("_")[2];0!=b?(c.checkAndPublish(this.id,d),e.$insertFlag=this.id.split("_")[1],sendClientStat(m,1,f,"pub_reply")):c.showLoginLayer()});b.delegate(".pop_user_login","click",function(){c.showLoginLayer()});a("#my-notification").delegate(".upvote","click",function(){alert("\u81ea\u5df1\u4e0d\u80fd\u9876\u81ea\u5df1");return!1});b.delegate(".upvote","click",function(){var b=a(this).attr("id"),
c=b.split("_")[1];e.uptId=b;if(a(this).hasClass("np-btn-active"))return!1;if(a.cookie("uid")==a(this).parent().parent().find(".np-user").attr("post_uid"))return alert("\u81ea\u5df1\u4e0d\u80fd\u9876\u81ea\u5df1"),!1;b=f;a(this).closest("[tid]").length&&(b=a(this).closest("[tid]").attr("tid"));a.ajax({url:e.wfetchUrl+"article/comment/up/to/"+c+"?targetid="+b,dataType:"jsonp",jsonpCallback:"ding",cache:!0,success:function(a){sendClientStat(m,1,f,"pub_up")}});c=a(this).find("em");b=parseInt(c.text());
c.html(b+1);a(this).addClass("np-btn-active")});b.delegate(".popClick","click",function(){a(this).attr("post_uid");var b=a(this).attr("post_uid");c.popupIframeLayer(b);sendClientStat(m,1,f,"clk_head")});b.delegate(".newcoment","click",function(){var b=a(this).attr("id").split("_")[1];a("#comment_"+b+">ul.children li .newcoment").hide();a("#comment_"+b+">ul.children li.undis").removeClass("undis").addClass("blueflag");c.iframeHeight();a(this).hide();a("#comment_"+b).data("num",0);a("#comment_"+b+">ul.children li.blueflag").each(function(b,
d){c.blueLine("#"+a(this).attr("id"))});sendClientStat(m,1,f,"clk_newreply_notice")});b.delegate(".spreadMoreBtn","click",function(){a(this).prev().css("height","");a(this).hide();c.iframeHeight()});b.delegate(".np-con-img","click",function(){a(this).unbind().bind("load",function(){c.iframeHeight()});var b=a(this).attr("src"),b=/\/150$/.test(b)?b.replace(/\/150$/,"/500"):b.replace(/\/500$/,"/150");a(this).attr("src",b)})},showLoginLayer:function(){publicLoginEvent()},onLogined:function(b,c,e){var d=
this.options;q=(""+b).match(/[1-9][0-9]*/)[0]||getUin();b=e?e:"http://mat1.gtimg.com/www/coral2.0/images/g.gif";d.$loginFlag.data("userPic",e);d.$loginFlag.data("nick",c);d.$loginFlag.find("img").attr("src",b);d.$loginFlag.find("span").html(c);d.$loginBtn.html("\u53d1\u8868\u8bc4\u8bba");d.$loginFlag.find("img").attr("src",b);d.$loginFlag.find("span").html(c);d.$loginFlag.show();a("#my-message .tipInfo").show();a(".pop_user_login").hide();a("#public_reply .np-btn-submit").html("\u56de\u590d");this.options.$loginFlag.data("userPic",
e);this.options.$loginFlag.data("nick",c);a("#my-message-list").html("");a("#my-notification-list").html("");a("#loadCmtMore").hide();this.options.loginuin&&this.options.$top_textarea.focus();this.iframeHeight();d.$urlapi_mycomment.msgid="";d.$urlapi.pageflag="0";d.$urlapi_mycomment.pageflag="0";this.changeUid();d.centerFlag&&d.$myCowComment.trigger("click");d.changeFlag&&(d.$myAllComment.trigger("click"),this.reportInit(),a("#tab2_myComments .tipInfo").removeClass("waitting").addClass("waitting").html("").show(),
a("#tab2_myComments .np-load-more").hide())},loginOut:function(b){var c=this.options;q=null;b||this.options.$logoutTrigger.click();c.$loginFlag.hide();a("#public_reply .np-btn-submit").html("\u767b\u5f55");c.$myAllComment.trigger("click");c.$loginBtn.html("\u767b\u5f55");a("#my-message-list").html("");a("#my-notification-list").html("");a("#loadCmtMore").hide();a("#loadMsgMore").hide();a.removeCookie("uid")},changeUid:function(){a.ajax({dataType:"jsonp",url:this.options.fetchUrl+"user/0?&source=0",
success:function(a){},error:function(a){}})},getLoginStatus:function(){return q?1:0},bindSubmitEvent:function(){var b=this,c=this.options;c.$loginBtn.unbind().click(function(){getUin()&&"\u767b\u5f55"!=a(this).html()?(b.checkAndPublish(this.id),c.$insertFlag="comment"):b.showLoginLayer()})},bindDeleteEvent:function(){var b=this;a("#mainBody").delegate(".delete","click",function(c){var e=a(this),d="popdelete",g=e.attr("id").split("_")[1];getUin()?(a("#my-notification-list li.np-post:last").attr("id")==
"post_"+g&&(d="popdeletee"),a("#my-notification-list li.np-post").css("z-index","1"),a(".popdeletee").remove(),a(".popdelete").remove(),a("#post_"+g).css("z-index","100"),e.append('<div class="'+d+'"><h4>\u60a8\u786e\u5b9a\u8981\u6c38\u4e45\u5220\u9664\u6b64\u8bc4\u8bba\uff1f</h4><p><input class="cancel" type="button" value="\u53d6\u6d88" id="d_cancel"/><input class="confirm" type="button" value="\u786e\u5b9a" id="d_confirm"/></p></div>'),a("#d_confirm").click(function(){b.postData(e.attr("id"),e.closest("[tid]").attr("tid"))}),
a("#d_cancel").click(function(){e.find("div").remove()})):b.showLoginLayer();c.stopPropagation()});l.unbind().bind("click",function(){a("#my-notification-list .delete div").remove()})},bindReportEvent:function(){var b=this,c=this.options,e=a(".np-report");a("#mainBody").delegate(".report","click",function(){var d=a(this);if(0!=b.getLoginStatus()){if(!a(this).find("em").length){a("#allComments .np-report").remove();a("#allComments li.np-post").css("z-index","1");a(this).parent().append(e.clone().show());
var g=a(this).attr("id").split("report_")[1];a("#"+g).css("z-index","100");a("#"+g).parents("li.np-post").css("z-index","100");a(this).attr("id").split("report_")[1]==a("#allComments li.np-post:last").attr("id")&&303>a("#allComments li.np-post:last .np-post-body:first").height()-37&&a("#allComments .np-report").css("top","-290px");a(this).attr("id").split("report_")[1]==a("#allComments li.np-post").eq(-2).attr("id")&&303>a("#allComments li.np-post:last .np-post-body:first").height()+a("#allComments li.np-post").eq(-2).find(".np-post-body:first").height()-
37&&a("#allComments .np-report").css("top","-290px");a(this).attr("id").split("report_")[1]==a("#allComments li.np-post").eq(-3).attr("id")&&303>a("#allComments li.np-post:last .np-post-body:first").height()+a("#allComments li.np-post").eq(-2).find(".np-post-body:first").height()+a("#allComments li.np-post").eq(-3).find(".np-post-body:first").height()-37&&a("#allComments .np-report").css("top","-290px");a(this).parent().find(".close").bind("click",function(){d.parent().find(".np-report").remove();
a("#allComments li.np-post").css("z-index","1")});a(this).parent().find(".np-report-cancel").bind("click",function(){d.parent().find(".np-report").remove();d.parents(".np-post").trigger("mouseout");a("#allComments li.np-post").css("z-index","1")});a(this).parent().find("#impeach_desc").focus(function(){a(this).val("");a(this).css("color","#333")});a(this).parent().find(".np-report-submit").bind("click",function(){d.parent().find("input[name='impeach_content']:checked").length?b.postData(d.attr("id"),
d.closest("[tid]").attr("tid")):(0==d.parent().find(".np-report h6").find("span").length&&d.parent().find(".np-report h6").append('<span id="RT">\u4f60\u5fc5\u987b\u9009\u62e9\u4e00\u9879\u624d\u80fd\u4e3e\u62a5!</span>'),setTimeout(function(){a("#RT").remove()},2E3))});c.reportId=a(this).attr("id")}}else b.showLoginLayer()});a("#mainBody").delegate("li.np-post","mouseover",function(b){a(this).find("img:first").attr("post_uid")!=a.cookie("uid")&&(a(".report").hide(),a(this).find(".report:first").show(),
b.stopPropagation())});a("#mainBody").delegate(".np-post","mouseout",function(b){a(this).find(".report em").length||a(this).find(".report:first").hide();b.stopPropagation()})},reportInit:function(){var b=this.options.$allComments.find("li.np-post .reportOn");a.each(b,function(b,e){a(this).removeClass("reportOn");a(this).find("em").remove()})},checkAndPublish:function(b,c){var e=this.options,d=b.replace(/pop/,"pop_text"),d=a("#"+d),g=b.split("_")[0];"top"==g&&(d=e.$top_textarea,sendClientStat(m,1,
f,"pub_original"));0==a.trim(d.val()).length||d.val()==e.topContentTips?this.pubCallback(b,{ret:1,error2show:"\u8bf7\u8f93\u5165\u5185\u5bb9\uff01"}):2E3<a.trim(d.val()).realLength()?alert("\u8d85\u8fc71000\u4e2a\u5b57\u4e86"):getUin()?("top"==g&&e.$loginBtn.addClass("np-btn-submit-loading"),this.postData(b,c)):this.showLoginLayer()},postData:function(b,c){var e=this.options;this._pubTimer0=(new Date).getTime();var d=generateToken(getKey()),g=b.replace(/pop/,"pop_text"),h=b.split("_")[2],r=b.split("_")[0],
l=b.split("_")[2];b.split("_");var k=a("input[name='impeach_content']:checked").length?a("input[name='impeach_content']:checked").val():" ",m=a("#"+b).parent().find('input[name="impeach_desc"]').val();"top"==r?this.submitForm({targetid:f,type:1,format:"SCRIPT",callback:e.topCallback,content:a.trim(e.$top_textarea.val()),_method:"put",g_tk:d,code:1,source:e.columSource,subsource:e.columsubSource}):"pop"==r?(a("#"+b).html("").removeClass("submit").addClass("np-btn-submit-loading"),this.submitForm({targetid:c||
f,type:1,format:"SCRIPT",callback:e.popCallback,content:a.trim(a("#"+g).val()),_method:"put",g_tk:d,code:1,source:e.columSource,subsource:e.columsubSource},h)):"report"==r?this.submitForm({targetid:c||f,type:k,desc:m,enterapp:"web",_method:"put",commentid:l,format:"SCRIPT",g_tk:d,callback:e.reportCallback},r):"delete"==r&&this.submitForm({targetid:c||f,_method:"delete",format:"SCRIPT",g_tk:d,callback:e.deleteCallback},b)},submitForm:function(b,c){var e=this.options,d="",d=c?"report"==c||"msg"==c?
"http://w.coral.qq.com/report/comment/0":"em"==c.split("_")[0]||"am"==c.split("_")[0]?e.wfetchUrl+"article/comment/up/to/"+c.split("_")[1]:"delete"==c.split("_")[0]?"http://w.coral.qq.com/article/comment/"+c.split("_")[1]:e.wfetchUrl+"article/comment/to/"+c:e.wfetchUrl+"article/comment/";a("#post_iframe").length||n.append('<iframe id="post_iframe" name="post_iframe" style="display:none"><script type="text/javascript">document.domain = "qq.com";\x3c/script></iframe>');e=a("#_messageform").length?a("#_messageform").attr("action",
d).empty():a('<form action="'+d+'" method="post" target="post_iframe" id="_messageform" style="display:none;"></form>').appendTo(n);for(name in b)e.append(a('<input name="'+name+'" type="hidden" value="" />').val(b[name]));e.submit()},sendStat:function(a){sendClientStat(m,2,f,"coral"==a?"pgv_commentdetail":"pgv_articledetail")},pubCallback:function(b,c,e){var d=b.split("_")[0],g=this.options,h=this,r="\u8bc4\u8bba\u6210\u529f!",f=!0,k=function(a){switch(a){case 0:h._trigger("pubsuccess",null,c);break;
case 8:h.showLoginLayer();break;case 9:case 13:case 14:case 16:case 17:h._trigger("pubsuccess",null,l);break;default:r="\u7cfb\u7edf\u51fa\u9519\u8bf7\u7a0d\u540e\u518d\u53d1"}};if("top"==d){if(c.ret)r=c.error2show||"<b>\u56e7</b>... \u51fa\u9519\u4e86\uff01 ",f=!1,setTimeout(function(){g.$top_textarea.focus();g.$topReply.find("span.np-tip-error").html(r).fadeOut("fast")},2E3);else{var l={data:{parent:"0",commentid:"222",time:"121212",content:""+h.encodeHTML(g.$top_textarea.val())+"",checktype:"0"}};
k(c.errCode);g.$loginBtn.removeClass("np-btn-submit-loading")}g.$topReply.find("span.np-tip-error").html(r).fadeIn("fast");f&&(g.$top_textarea.val(""),setTimeout(function(){g.$topReply.find("span.np-tip-error").hide();g.$topReply.find("span.fontsline").show()},2E3))}else if("pop"==d){var d=b.replace(/pop_/,""),m=a("#"+d+">.children .tips"),p=a("#content").find(".pop_reply:visible .np-tip-error"),n=a("#content").find(".pop_reply:visible textarea"),q=b.replace(/pop/,"pop_text");c.ret?(tips=c.error2show||
"<b>\u56e7</b>... \u51fa\u9519\u4e86\uff01 ",m.html(tips).hide().fadeIn("slow"),setTimeout(function(){a("#"+q).focus();m.html("")},2E3)):(l={data:{parent:g.replylistId,commentid:"222",time:"\u521a\u521a",content:h.encodeHTML(a(n).val()),checktype:"0"}},k(c.errCode),p.html(r).hide().fadeIn("slow"),a("#content").find(".pop_reply:visible .np-reply-box-footer a").removeClass("submitOn").addClass("submit").html("\u56de\u590d"),setTimeout(function(){a(n).focus();p.html("")},2E3))}else"report"==d?(0==c.errCode?
(a("#report_comment_"+c.data.commentid).html("").append("<em>24\u5c0f\u65f6\u5185\u7ed9\u60a8\u53cd\u9988\uff0c\u89c1\u6211\u7684\u725b\u8bc4</em>"),a("#report_top_"+c.data.commentid).html("").append("<em>24\u5c0f\u65f6\u5185\u7ed9\u60a8\u53cd\u9988\uff0c\u89c1\u6211\u7684\u725b\u8bc4</em>"),a("#report_msg_"+c.data.commentid).html("").append("<em>24\u5c0f\u65f6\u5185\u7ed9\u60a8\u53cd\u9988\uff0c\u89c1\u6211\u7684\u725b\u8bc4</em>")):12==c.errCode?a("#"+g.reportId).html("").append("<em>\u60a8\u4eca\u5929\u4e3e\u62a5\u7684\u6761\u6570\u5df2\u8fbe\u4e0a\u9650</em>"):
a("#"+g.reportId).html("").append("<em>\u8be5\u8bc4\u8bba\u5df2\u88ab\u4e3e\u62a5\u6216\u5904\u7406!</em>"),a("#"+g.reportId).addClass("np-btn-active"),a(".np-report").remove()):"delete"==d&&0==c.errCode&&a("#post_"+c.data.commentid).animate({height:"0px"},"slow",function(){a(this).remove();h.iframeHeight()});e&&Qoss("hfpljk",this._pubTimer0,{3:e})},encodeHTML:function(a){var c="";if(0==a.length)return"";c=a.replace(/&/g,"&gt;");c=c.replace(/</g,"&lt;");c=c.replace(/>/g,"&gt;");c=c.replace(/ /g,"&nbsp;");
c=c.replace(/\'/g,"&#39;");c=c.replace(/\"/g,"&quot;");return c=c.replace(/\n/g,"<br>")},insertTempComment:function(b,c,e,d,g){var h=this.options;q||getUin();var f=h.$loginFlag.find(".np-user").html(),l=h.$loginFlag.find("img").attr("src"),k="",k=c.replace("<script>","&lt;script&gt;"),k=k.replace("\x3c/script>","&lt;/script&gt;");1==g?(c={id:b,parent:0,time:d,content:c,up:0,userinfo:{userid:a.cookie("uid"),commentnum:"",upnum:0,nick:f,head:l,region:""}},k=this.creatHtml(c,"blueflag",h.$insertFlag)):
k='<li class="np-post temporary blueflag" id="comment_'+b+'"><div class="np-tip-newpost"></div><img class="np-avatar" src="'+l+'" alt="\u5934\u50cf"><div class="np-post-body"><div class="np-post-header"><a href="javascript:void(0)" class="np-user">'+f+'</a><span class="np-time">\u521a\u521a</span></div><div class="np-post-content"><p>'+k+"</p></div></div></li>";if(0!=parseInt(e)){if(a("#top_"+e).length||a("#comment_"+e).length||a("#post_"+e).length||a("#msg_"+e).length)a("#top_"+e+">ul.children").prepend(k).children("div.pop_reply").hide(),
a("#comment_"+e+">ul.children").prepend(k).children("div.pop_reply").hide(),a("#post_"+e+">ul.children").children("div.pop_reply").hide(),a("#msg_"+e+">ul.children").prepend(k).children("div.pop_reply").hide(),this.iframeHeight()}else a("#allComments .tipInfo:visible")&&a("#allComments .tipInfo").hide(),h.$allComments.find(".np-title-new").length?(h.$allComments.find(".np-title-new").after(k),e=a("#comment_"+b).offset().top+a(top.document).scrollTop(),a(top.document.body).animate({scrollTop:e},800),
a(top.window).scrollTop(e)):h.$allComments.find(".post-list").prepend(k),this.iframeHeight();"post"!=h.$insertFlag?this.blueLine("#"+h.$insertFlag+"_"+b):this.blueLine("#comment_"+b)},iframeHeight:function(){var b=a("#mainBody").height();a(parent.document.body).find("#commentIframe").height(b)},popupIframeLayer:function(b){a(top.document.body).append('<iframe src ="http://www.qq.com/coral/coralBeta2/coralPopDom2.0.htm" allowTransparency="true"  frameborder="0" scrolling="no" style="width:100%;height:100%;z-index:999999;position:fixed;_position:absolute;*+position:fixed;_left:100px;top:0px;left:0px;border:none;overflow:hidden;" id="np-pop-iframe" data-id = '+
b+"></iframe>");a.browser.msie&&"6.0"==a.browser.version&&!a.support.style&&0!=a(top.document.body).find("#np-pop-iframe").length&&a(top.document.body).find("#np-pop-iframe").css("position","absolute")},bindOtherEvents:function(){var b=this,c=this.options;c.$top_textarea.width(c.$top_textarea.parent().outerWidth()-20);c.$top_textarea.height(60);c.$top_textarea.css("padding","10px");a("#np-reply-box").delegate("a.change","click",function(){c.changeFlag=1;b.showLoginLayer()});c.$myCowComment.unbind().bind("click",
function(){var e=b.getLoginStatus();sendClientStat(m,1,f,"clk_myniuping");if(0!=e)if(a(this).addClass("np-active"),c.$myAllComment.removeClass("np-active"),c.$allComments.hide(),c.$myComments.show(),a("#mytips").trigger("click"),"none"!=a("#popMsg").css("display"))b.loadMyMessage(),a("#my-message .tipInfo").hide(),a("#popMsg").html("").hide(),a("#mytips").trigger("click");else if(a(this).hasClass("np-active"))""==a("#popMsg").html()?0<=a("#my-message-list li").length||a("#popMsg").html("").hide():
(a("#my-message-list").html(""),a("#popMsg").html("").hide(),b.loadMyMessage());else{if(a(this).hasClass("np-active"))"none"!=a("#popMsg").css("display")&&(a("#my-message-list").html(""),b.loadMyMessage(),a("#popMsg").html("").hide());else if(a("#my-message-list li").length)"none"!=a("#popMsg").css("display")&&(a("#my-message-list").html(""),a("#popMsg").html("").hide(),b.loadMyMessage());else return;b.checkAndPublish(this.id)}else c.centerFlag=1,a("#my-message .tipInfo").hide(),a("#my-notification .tipInfo").hide(),
b.showLoginLayer()});c.$myAllComment.unbind().bind("click",function(){a(this).addClass("np-active");c.$myCowComment.removeClass("np-active");c.$allComments.show();c.$myComments.hide();b.iframeHeight()})},formatTime:function(a){var c=this.options.$nowDate/1E3-a;if(1>c)return"\u521a\u521a";if(60>c)return Math.floor(c)+"\u79d2\u949f\u524d";if(3600>c)return Math.floor(c/60)+"\u5206\u949f\u524d";if(86400>c)return Math.floor(c/3600)+"\u5c0f\u65f6\u524d";if(604800>c)return Math.floor(c/86400)+"\u5929\u524d";
a=new Date(1E3*a);c=a.getFullYear()+"-";c+=a.getMonth()+1+"-";return c+=a.getDate()},conHeight:function(b){var c=a("#allComments .np-post .np-post-content[data-height!=5]"),e=24;a("#allComments .np-post .np-post-content").length&&(/px/.test(c.css("line-height"))&&(e=c.css("line-height").split("px")[0]),2==b&&(c=a("#my-message-list .np-post .np-post-content[data-height!=5] p")),3==b&&(c=a("#my-notification-list .np-post .np-post-content[data-height!=5]")),5==b&&(c=a("#allComments .topIco .np-post-content[data-height!=5]")),
c.each(function(b,c){a(this).attr("data-height","5");a(this).height()>6*e&&!a(this).next(".spreadMoreBtn").length&&(a(this).css({height:5*e,overflow:"hidden"}),a(this).after('<a href="javascript:void(0)" class="spreadMoreBtn np-btn np-btn-spread"><i class="np-icon np-icon-spread"></i></a>'))}))},updateTime:function(){var b=this;this.options.$content.find(".uptime").each(function(){a(this).html(b.formatTime(a(this).attr("date")))});a("#my-message").find(".time").each(function(){a(this).html(b.formatTime(a(this).attr("date")))});
a("#my-notification").find(".post-time span").each(function(){a(this).html(b.formatTime(a(this).attr("date")))});a("#hiddenCon").find(".uptime").each(function(){a(this).html(b.formatTime(a(this).attr("date")))})},subString:function(a,c){a=a||"";var e=/[^\x00-\xff]/g;if(a.replace(e,"mm").length<=c)return a;for(var d=Math.floor(c/2);d<a.length;d++)if(a.substr(0,d).replace(e,"mm").length>=c)return a.substr(0,d)+"...";return a},myCreateHtml:function(b,c,e){var d="",g="",h="",f="msg_",l="",k=this.options.popupInfo,
l='<a href="#" class="np-link-weak"href="'+(b.targetinfo?b.targetinfo.url:"")+'">'+b.targetinfo.title+"</a>",f="";0!=b.repnum&&(f=this.creatPostLink(b));var m="<p>"+b.content.replace(/\n/g,"<br />")+f+"</p>";void 0!=b.picture&&b.picture.length&&(m="<p>"+b.content.replace(/\n/g,"<br />")+'</p><div><img class="np-con-img" src="'+b.picture[0].url+'/150" />'+f+"</div>");if("message"==c){"4"==b.tipstype&&(0<b.userlist.length&&(a.each(b.userlist,function(a,b){0<a&&(h+="\u3001");h+='<a href="javascript:void(0)" post_uid='+
b.userid+'  class="np-user '+k+'">'+b.nick+"</a>"}),b.userlist.length<b.up&&(h+="\u7b49")),d='<li class="post np-post '+e+'" id="msg_'+b.id+'" tid="'+b.targetinfo.targetid+'"><div class="np-post-header"><span class="np-avatar np-avatar-upvote"></span>'+h+b.up+'\u9876\u4e86\u4f60\u7684\u8bc4\u8bba\uff1a<span class="np-text-strong">'+(""==a.trim(b.content)?"\u53d1\u8868\u4e86\u4e00\u5f20\u56fe\u7247":this.subString(b.content,46))+this.creatPostLink(b)+'</span><span class="np-time" date="'+b.tipstime+
'">'+this.formatTime(b.tipstime)+'</span></div><div class="np-post-content"><a class="np-link-weak" target="_blank" href="'+(b.targetinfo?b.targetinfo.url:"")+'">'+b.targetinfo.title+'</a></div><div class="np-post-footer"></div><ul class="children"></ul></li>');"3"==b.tipstype&&(b.userinfo.head&&(g=b.userinfo.head.replace(/140/,"40")||"http://t0.qlogo.cn/mbloghead/01676c4b10bbdb6f2618/50"),d+='<li class="np-post '+e+'" id="msg_'+b.id+'" tid="'+b.targetinfo.targetid+'"><div class="np-post-body"><div class="np-post-header"><img class="np-avatar '+
k+'"  post_uid="'+b.userinfo.userid+'" src="'+g+'" alt="\u5934\u50cf"><a href="javascript:void(0)" class="np-user '+k+'" post_uid="'+b.userinfo.userid+'">'+b.userinfo.nick+'</a>\u56de\u590d\u4e86\u4f60\u7684\u8bc4\u8bba<span class="np-text-strong">'+this.subString(b.parentinfo.content,46)+this.creatPostLink(b.parentinfo)+'</span><span class="np-time" date="'+b.tipstime+'">'+this.formatTime(b.tipstime)+'</span><a class="np-btn np-btn-report report" id="report_msg_'+b.id+'">\u4e3e\u62a5</a></div><div class="np-post-content">'+
m+'<a class="np-link-weak" target="_blank" href="'+(void 0!=b.targetinfo?b.targetinfo.url:"")+'">'+b.targetinfo.title+'</a></div><div class="np-post-footer"><a href="javascript:void(0)" class="np-btn np-btn-upvote upvote" id="am_'+b.id+'">(<em>'+b.up+'</em>)</a><a href="javascript:void(0)" class="np-btn np-btn-reply reply">\u56de\u590d</a></div></div><ul class="children"></ul></li>');"6"==b.tipstype&&(d+='<li class="np-post '+e+'" id="msg_'+b.id+'" tid="'+b.targetinfo.targetid+'">',d+='<div class="np-post-body"><div class="np-post-header">',
d+='<img class="np-avatar '+k+'"  post_uid="'+b.userinfo.userid+'" src="http://t0.qlogo.cn/mbloghead/01676c4b10bbdb6f2618/50" alt="\u5934\u50cf">',d+='\u6587\u7ae0<a href="javascript:void(0)" style="cursor:default">'+b.targetinfo.title+'</a>\u5f15\u7528\u4e86\u4f60\u7684\u8bc4\u8bba<span class="np-text-strong">'+this.subString(b.content,46)+"</span>",d+='<span class="np-time" date="'+b.tipstime+'">'+this.formatTime(b.tipstime)+"</span>",d+="</div>",d+='<div class="np-post-content">',d+='<a class="np-link-weak" target="_blank" href="'+
(b.targetinfo?b.targetinfo.url:"")+'">'+b.targetinfo.title+"</a>",d+="</div>",d+='<div class="np-post-footer">',d+="</div></div>",d+='<ul class="children"></ul>',d+="</li>");var n,g=" ";b.targetinfo&&(n=b.targetinfo.url||"",g=b.targetinfo.title||"");"5"==b.tipstype&&(d+='<li class="post np-post '+e+'">',d+='<div class="np-post-header">',d+='<span class="np-avatar np-avatar-report"></span>',d+='\u4f60\u4e3e\u62a5\u4e86<a href="javascript:void(0)" post_uid='+b.userinfo.userid+'  class="np-user '+k+
'">'+(""!=b.userinfo.nick?b.userinfo.nick:"\u7f51\u53cb")+"</a>",d+='\u7684\u8bc4\u8bba\uff1a<span class="np-text-strong">'+this.subString(b.content,46)+"</span>",d+='<span class="np-time time" date="'+b.tipstime+'">'+this.formatTime(b.tipstime)+"</span>",d+="</div>",d+='<div class="np-post-content">',d+='<div class="message-content">',d+="<div>"+(2==b.checkstatus?"\u7ecf\u5ba1\u6838\u88ab\u5220\u9664":"\u7ecf\u5ba1\u6838\u4e3e\u62a5\u65e0\u6548")+"</div>",d+="</div>",d+='<a class="np-link-weak" target="_blank"  href="'+
n+'">'+g,d+='</a></div><div class="np-post-footer"></div></li>');b.userinfo.head&&b.userinfo.head.replace(/140/,"40")}"myComment"==c&&(f="post_",c="",c=0!=b.parent&&b.parentinfo?"<div>\u56de\u590d\u4e86<a post_uid="+b.parentinfo.userinfo.userid+' href="javascript:void(0)" class="np-user '+k+'">'+b.parentinfo.userinfo.nick+'</a>\u7684\u8bc4\u8bba<span class="np-text-strong">'+this.subString(b.parentinfo.content,46)+"</span></div>":"\u53d1\u8868\u8bc4\u8bba",l='<a href="'+b.targetinfo.url+'" target = "_blank" class="np-link-weak">'+
(b.targetinfo.title?b.targetinfo.title:" ")+"</a>",d='<li class="np-post" id='+f+""+b.id+" tid="+b.targetinfo.targetid+'><div class="np-post-body"><div class="np-post-header"><span class="np-time">'+(b.time?this.formatTime(b.time):"\u521a\u521a")+"</span>"+c+'</div><div class="np-post-content">'+m+l+'</div><div class="np-post-footer"><span class="np-btn-upvote">'+b.up+'</span><span class="np-btn-reply reply">'+b.repnum+'</span><span class="np-btn-delete delete" id=delete_'+b.id+'>\u5220\u9664</span></div></div><ul class="children"></ul></li>');
return d},loadMyMessage:function(){var b=this,c=this.options,e=c.$urlapi,d="",g=c.centerPageSize,h=1;1==c.$urlapi.pageflag&&(g=20,h=2);a.ajax({url:c.fetchUrl+"user/"+c.$urlapi.userId+"/msg?msgid="+c.$urlapi.msgid+"&pageflag="+c.$urlapi.pageflag+"&reqnum="+g,dataType:"jsonp",beforeSend:function(){b._tips0=(new Date).getTime()},success:function(f){var l=(new Date).getTime();if(8==f.errCode)b.showLoginLayer();else{if(0==f.errCode){if(0==e.pageflag&&(e.msgid=e.first=f.data.first,e.last=f.data.last,a("#my-message-list").html(""),
f.data.retnum<f.data.total&&10==f.data.retnum&&a("#loadMsgMore").show(),0==f.data.retnum)){a("#my-message").children(".tipInfo").removeClass("waitting").html("\u6682\u65e0\u63d0\u9192").show();a("#loadMsgMore").hide();return}1==e.pageflag&&(e.msgid=e.last=f.data.last);var k="";2==e.pageflag&&(e.msgid=e.first=f.data.first,k="blueflag");a.each(f.data.message,function(a,c){d+=b.myCreateHtml(c,"message",k)});1==c.$urlapi.pageflag?(a("#my-message-list").append(d),b.iframeHeight()):(a("#my-message-list").prepend(d),
b.iframeHeight(),a("#my-message-list .blueflag").each(function(c,d){b.blueLine("#"+a(this).attr("id"))}));2==h&&b.conHeight(2);b.iframeHeight();f.data.retnum<g||f.data.total<=g?(a("#loadMsgMore>span").hide(),a("#loadMsgMore>em").removeClass("np-load-more-loading")):(a("#loadMsgMore>span").show(),a("#loadMsgMore>em").hide());a("#my-message").children(".tipInfo").hide();b.iframeHeight()}else 0==f.errCode&&0==f.data.retnum?0==a("#my-message-list li").length?a("#my-message").children(".tipInfo").removeClass("waitting").html("\u6682\u65e0\u63d0\u9192").show():
a("#my-message").children(".tipInfo").hide():(a("#my-message").children(".tipInfo").removeClass("waitting").html("\u6682\u65e0\u63d0\u9192").show(),a("#loadMsgMore").hide());Qoss("wdtx",b._tips0,{1:b._tips0+1,2:l,3:l},100)}}})},loadMyComment:function(){var b=this,c=this.options,e=c.centerPageSize;0==c.$urlapi_mycomment.pageflag&&(c.$urlapi_mycomment.last=0);1==c.$urlapi_mycomment.pageflag&&(e=20);a.ajax({url:c.fetchUrl+"user/"+c.$urlapi_mycomment.userId+"/comment?lastid="+c.$urlapi_mycomment.last+
"&pageflag="+c.$urlapi_mycomment.pageflag+"&reqnum="+e,dataType:"jsonp",jsonpCallback:"myComment",beforeSend:function(){b._myCom0=(new Date).getTime()},success:function(d){var f="";if(8==d.errCode)b.showLoginLayer();else{if(0==d.errCode){var h=(new Date).getTime(),l=d.data.usermeta.region.replace(/:/g," "),l=""!=a.trim(l)?l:"\u817e\u8baf\u7f51\u53cb";a("#myuserInfo").find("img").attr("src",d.data.usermeta.head||"");a("#myuserInfo").find(".np-user").html(d.data.usermeta.nick);a("#myuserInfo").find(".a").html(l);
a("#myuserInfo").find(".b").html(d.data.usermeta.upnum);a("#myuserInfo").find(".c").html(d.data.usermeta.commentnum);a("#myuserInfo").show();if(0==c.$urlapi_mycomment.pageflag&&(c.$urlapi_mycomment.msgid=c.$urlapi_mycomment.first=d.data.first,c.$urlapi_mycomment.last=d.data.last,a("#my-notification-list").html(""),10==d.data.retnum&&a("#loadCmtMore").show(),0==d.data.retnum)){a("#my-notification").children(".tipInfo").removeClass("waitting").html("\u6682\u65e0\u8bc4\u8bba").show();a("#loadCmtMore").hide();
a("#myuserInfo").hide();b.iframeHeight();return}1==c.$urlapi_mycomment.pageflag&&(c.$urlapi_mycomment.last=d.data.last);a.each(d.data.comments,function(a,c){f+=b.myCreateHtml(c,"myComment")});a("#my-notification-list").append(f);b.conHeight(2);b.iframeHeight();setTimeout(function(){b.iframeHeight()},200);d.data.retnum<e||d.data.total<=e?(a("#loadCmtMore>span").hide(),a("#loadCmtMore>em").removeClass("np-load-more-loading")):(a("#loadCmtMore>span").show(),a("#loadCmtMore>em").hide());a("#my-notification").children(".tipInfo").hide()}else a("#my-notification").children(".tipInfo").removeClass("waitting").html("\u6682\u65e0\u8bc4\u8bba").show(),
a("#loadCmtMore").hide(),0==a("#my-notification-list li").length&&a("#my-notification").children(".tipInfo").show(),b.iframeHeight();Qoss("wdpl",b._myCom0,{1:b._myCom0+1,2:h,3:h},100)}}})},clickLoadMore:function(){var b=this,c=this.options;a("#loadMsgMore>span").click(function(){a("#loadMsgMore>span").hide();a("#loadMsgMore>em").addClass("np-load-more-loading").show();c.$urlapi.pageflag=1;c.$urlapi.msgid=c.$urlapi.last;b.loadMyMessage();sendClientStat(m,1,f,"clk_notice_more")});a("#loadCmtMore>span").click(function(){a("#loadCmtMore>span").hide();
a("#loadCmtMore>em").addClass("np-load-more-loading").show();c.$urlapi_mycomment.pageflag=1;c.$urlapi_mycomment.msgid=c.$urlapi_mycomment.last;b.loadMyComment();sendClientStat(m,1,f,"clk_mycomment_more")})},creatPostLink:function(a){return"<a class='"+this.options.popupLink+"' targetid='"+a.targetid+"' commentid='"+a.id+"' parentid='"+a.parent+"' href='javascript:void(0)'><img src='http://mat1.gtimg.com/www/niuping2013/postframe/transparent.gif' /></a>"},initPostFrame:function(){var b=this,c=this.options;
a("#content").delegate("."+c.popupLink,"click",function(c){c=b.options.$loginFlag.data("nick");var d=b.options.$loginFlag.data("userPic"),f=a(this),h=f.attr("targetid"),l=f.attr("commentid"),f=f.attr("parentid");a(top.document.body).append('<iframe src="http://www.qq.com/coral/postframe/postframe.htm?'+(new Date).getDate()+'" id="np-pop-iframe" allowtransparency="true" frameborder="0" scrolling="no" style="width: 100%; z-index: 9999; position: fixed; top: 0px; left: 0px; border: none; overflow: hidden; height: 100%;" data-nick="'+
c+'" data-pic="'+d+'" data-id="'+h+"_"+l+'" parentid="'+f+'"></iframe>')})}});l.comment()})(jQuery)});String.prototype.realLength=function(){return this.replace(/[^\x00-\xff]/g,"**").length};function topCallback(a){jQuery(document).comment("pubCallback","top",a,(new Date).getTime())}function popCallback(a){jQuery(document).comment("pubCallback","pop",a,(new Date).getTime())}function reportCallback(a){jQuery(document).comment("pubCallback","report",a,(new Date).getTime())}
function deleteCallback(a){jQuery(document).comment("pubCallback","delete",a,(new Date).getTime())}function getUin(){var a="";if(jQuery.cookie("uin")){if(a=jQuery.cookie("uin"),a.match(/[1-9][0-9]*/)instanceof Array)return a.match(/[1-9][0-9]*/)[0]}else return a=jQuery.cookie("luin")}function getKey(){return jQuery.cookie("skey")||jQuery.cookie("lskey")}function generateToken(a){var l=2013;if(a)for(var n=0,q=a.length;n<q;n++)l+=(l<<5)+a.charCodeAt(n);return l&2147483647}
function publicLoginEvent(){parent.registerCoralEvent&&parent.registerCoralEvent.loginEvent?parent.registerCoralEvent.loginEvent():jQuery(parent.document.getElementById("onekey")).click()}function publicLogined(a,l,n){a&&(jQuery(document).comment("onLogined",a,l,n),top.document.getElementById("np-pop-iframe")&&top.document.getElementById("np-pop-iframe").contentWindow.publicLogined(a,l,n))}function publicLogout(){jQuery(document).comment("loginOut")}
function Qoss(a,l,n,q){for(var f in n)n[f]-=l;jQuery('<img src="http://qos.report.qq.com/collect?type=1&name=coral_qq_com_'+a+"&"+jQuery.param(n)+'">').error(function(){jQuery(this).remove()}).load(function(){jQuery(this).remove()}).appendTo("body")}
function sendClientStat(a,l,n,q,f){var m=location.protocol+"//"+location.host+location.pathname,b=parseInt(1E9*Math.random()),c=getUin()||"",e=jQuery.cookie("uid"),d=encodeURIComponent(location.host);if("coral"==a)if(1==l){l=1836;var g="coral.web.comment_detail.action"}else l=1837,g="coral.web.comment_detail.pgv";else 1==l?(l=1836,g="coral.web.article_detail.action"):(l=1837,g="coral.web.article_detail.pgv");f=f||0;g_btrace_BOSS=new Image(1,1);g_btrace_BOSS.src="http://btrace.qq.com/collect?sIp=0&iQQ="+
c+"&sBiz="+g+"&sOp="+q+"&iSta="+f+"&iTy="+l+"&iFlow="+b+"&isite="+a+"&iTargetid="+n+"&iuid="+e+"&iUrl="+m+"&idomain="+d};/*  |xGv00|1137319e2aa5208daa5e10bac0692aba */